{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AI Pattern Recognition Schema",
  "description": "Schema for identifying and storing common AI interaction patterns to reduce API calls",
  "type": "object",
  "required": ["pattern_id", "type", "usage", "tokens"],
  "properties": {
    "pattern_id": {
      "type": "string",
      "description": "Unique identifier for the pattern"
    },
    "type": {
      "type": "string",
      "enum": ["code", "prompt", "response", "error", "workflow"],
      "description": "Type of pattern for categorization"
    },
    "usage": {
      "type": "object",
      "required": ["count", "success_rate"],
      "properties": {
        "count": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of times pattern was used"
        },
        "success_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Success rate of pattern usage"
        },
        "last_used": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "tokens": {
      "type": "object",
      "required": ["average_saved"],
      "properties": {
        "average_saved": {
          "type": "number",
          "description": "Average tokens saved per use"
        },
        "total_saved": {
          "type": "number",
          "description": "Total tokens saved using this pattern"
        }
      }
    },
    "pattern": {
      "type": "object",
      "required": ["trigger", "template"],
      "properties": {
        "trigger": {
          "type": "object",
          "properties": {
            "conditions": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "confidence_threshold": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        },
        "template": {
          "type": "object",
          "properties": {
            "content": {
              "type": "string",
              "description": "Template with placeholders"
            },
            "variables": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "optimization": {
      "type": "object",
      "properties": {
        "cache_priority": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5
        },
        "auto_apply": {
          "type": "boolean",
          "default": true
        },
        "min_confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.8
        }
      }
    }
  },
  "examples": [
    {
      "pattern_id": "code_review_py",
      "type": "code",
      "usage": {
        "count": 150,
        "success_rate": 0.95,
        "last_used": "2024-01-20T10:30:00Z"
      },
      "tokens": {
        "average_saved": 200,
        "total_saved": 30000
      },
      "pattern": {
        "trigger": {
          "conditions": [
            "file_extension=.py",
            "contains=def",
            "request_type=review"
          ],
          "confidence_threshold": 0.8
        },
        "template": {
          "content": "Review Python function: {{code_block}}",
          "variables": ["code_block"]
        }
      },
      "optimization": {
        "cache_priority": 1,
        "auto_apply": true,
        "min_confidence": 0.8
      }
    }
  ]
}
